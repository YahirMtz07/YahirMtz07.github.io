<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Efunctions Fisica IV Imanes</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="icon" type="image/png" href="imagen/logo eFunctions.png"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/gsap.min.js"></script>
        <style id="app-style">
            :root {
                --primary: #3b82f6;
                --secondary: #6366f1;
                --accent: #f43f5e;
                --background: #f8fafc;
                --text: #1e293b;
            }

            body {
                font-family: 'Inter', sans-serif;
                background-color: var(--background);
                color: var(--text);
                overflow-x: hidden;
            }

            .app-container {
                min-height: 100vh;
            }

            .tab-content {
                display: none;
            }

            .tab-content.active {
                display: block;
            }

            .tab-button {
                transition: all 0.3s ease;
            }

            .tab-button.active {
                background-color: var(--primary);
                color: white;
            }

            .simulator-canvas {
                background-color: #f1f5f9;
                border-radius: 0.5rem;
                overflow: hidden;
                position: relative;
            }

            .magnet {
                cursor: grab;
                user-select: none;
            }

            .magnet:active {
                cursor: grabbing;
            }

            .field-line {
                stroke: var(--primary);
                stroke-width: 1.5;
                fill: none;
                opacity: 0.6;
            }

            input[type="range"] {
                -webkit-appearance: none;
                width: 100%;
                height: 6px;
                border-radius: 3px;
                background: #d1d5db;
                outline: none;
            }

            input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: var(--primary);
                cursor: pointer;
            }

            .control-panel {
                background-color: rgba(255, 255, 255, 0.9);
                border-radius: 0.5rem;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }

            .globe-container {
                width: 100%;
                height: 300px;
                position: relative;
            }

            .tooltip {
                position: relative;
                display: inline-block;
            }

            .tooltip .tooltip-text {
                visibility: hidden;
                width: 200px;
                background-color: #374151;
                color: white;
                text-align: center;
                border-radius: 6px;
                padding: 8px;
                position: absolute;
                z-index: 1;
                bottom: 125%;
                left: 50%;
                transform: translateX(-50%);
                opacity: 0;
                transition: opacity 0.3s;
            }

            .tooltip:hover .tooltip-text {
                visibility: visible;
                opacity: 1;
            }

            .reset-button {
                position: fixed;
                bottom: 2rem;
                right: 2rem;
                z-index: 100;
            }


            @media (max-width: 768px) {
                .tabs-container {
                    flex-direction: column;
                }

                .tabs-nav {
                    flex-direction: row;
                    overflow-x: auto;
                    width: 100%;
                }

                .tab-button {
                    white-space: nowrap;
                }
            }

            .animate-pulse {
                animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }

            @keyframes pulse {
                0%, 100% {
                    opacity: 1;
                }
                50% {
                    opacity: .5;
                }
            }

            .pulsating-field {
                animation: pulsate 3s ease-in-out infinite;
            }

            @keyframes pulsate {
                0% {
                    opacity: 0.3;
                }
                50% {
                    opacity: 0.8;
                }
                100% {
                    opacity: 0.3;
                }
            }
        </style>
    </head>
    <body>
        <div class="app-container bg-gradient-to-br from-blue-50 to-indigo-50">
            <header class="bg-white shadow-md p-4">
                <div class="container mx-auto flex justify-between items-center">
                    <h1 class="text-2xl font-bold text-blue-600">
                        <i class="fas fa-magnet mr-2"></i>eFunctions Fisica IV Imanes
                    </h1>
                    <p class="hidden md:block text-gray-600">Aprende los principios del magnetismo de forma interactiva</p>
                </div>
            </header>

            <main class="container mx-auto p-4">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

                    <section class="bg-white rounded-lg shadow-lg p-6">
                        <h2 class="text-xl font-bold mb-4 text-blue-700">
                            <i class="fas fa-book-open mr-2"></i>Teoría Interactiva
                        </h2>
                        <div class="tabs-container">
                            <div class="tabs-nav flex mb-4 overflow-x-auto">
                                <button class="tab-button active px-4 py-2 mr-2 rounded-md border border-blue-500 text-blue-600 font-medium" data-tab="clasificacion">Clasificación</button>
                                <button class="tab-button px-4 py-2 mr-2 rounded-md border border-blue-500 text-blue-600 font-medium" data-tab="convencion">Convención de Polos</button>
                                <button class="tab-button px-4 py-2 mr-2 rounded-md border border-blue-500 text-blue-600 font-medium" data-tab="magnetizacion">Métodos de Magnetización</button>
                                <button class="tab-button px-4 py-2 rounded-md border border-blue-500 text-blue-600 font-medium" data-tab="teorias">Teorías</button>
                            </div>
                            <div class="tab-content-container">
                                <div class="tab-content active" id="clasificacion">
                                    <div class="flex flex-col md:flex-row">
                                        <div class="md:w-1/2 mb-4 md:mb-0 md:mr-4">
                                            <h3 class="text-lg font-semibold mb-2">Tipos de Imanes</h3>
                                            <p class="mb-3">Los imanes se pueden clasificar en tres tipos principales:</p>
                                            <ul class="list-disc pl-6 mb-4">
                                                <li class="mb-2"><strong>Imanes naturales:</strong> Como la magnetita, ocurren naturalmente en la Tierra.</li>
                                                <li class="mb-2"><strong>Imanes artificiales:</strong> Creados mediante procesos industriales con materiales ferromagnéticos.</li>
                                                <li class="mb-2"><strong>Electroimanes:</strong> Generan magnetismo a través de corriente eléctrica.</li>
                                            </ul>
                                        </div>
                                        <div class="md:w-1/2 flex justify-center items-center">


                                            <img style="border-radius: 20px;" src="imagen/imanes.png" alt="alt"/>


                                        </div>
                                    </div>
                                </div>
                                <div class="tab-content" id="convencion">
                                    <div class="flex flex-col md:flex-row">
                                        <div class="md:w-1/2 mb-4 md:mb-0 md:mr-4">
                                            <h3 class="text-lg font-semibold mb-2">Convención de Polos</h3>
                                            <p class="mb-3">Todos los imanes tienen dos polos:</p>
                                            <ul class="list-disc pl-6 mb-4">
                                                <li class="mb-2"><strong>Polo Norte (N):</strong> Si el imán se suspende libremente, este polo apunta hacia el norte geográfico.</li>
                                                <li class="mb-2"><strong>Polo Sur (S):</strong> Apunta hacia el sur geográfico.</li>
                                                <li class="mb-2"><strong>Interacción:</strong> Polos iguales se repelen, polos opuestos se atraen.</li>
                                                <li class="mb-2"><strong>Inseparabilidad:</strong> Los polos magnéticos siempre existen en pares. No es posible aislar un solo polo magnético.</li>
                                            </ul>
                                        </div>
                                        <div class="md:w-1/2 flex justify-center items-center">
                                            
                                            <img style="border-radius: 20px;" src="imagen/Screenshot 2025-06-19 103610.png" alt="alt"/>

                                           
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-content" id="magnetizacion">
                                    <div class="flex flex-col md:flex-row">
                                        <div class="md:w-1/2 mb-4 md:mb-0 md:mr-4">
                                            <h3 class="text-lg font-semibold mb-2">Métodos de Magnetización</h3>
                                            <p class="mb-3">Existen varios métodos para magnetizar materiales ferromagnéticos:</p>
                                            <ul class="list-disc pl-6 mb-4">
                                                <li class="mb-2"><strong>Frotamiento:</strong> Frotar un material ferromagnético con un imán en una dirección.</li>
                                                <li class="mb-2"><strong>Inducción:</strong> Colocar un material ferromagnético cerca de un imán permanente.</li>
                                                <li class="mb-2"><strong>Corriente eléctrica:</strong> Pasar corriente eléctrica a través de un conductor enrollado alrededor del material.</li>
                                                <li class="mb-2"><strong>Campo magnético terrestre:</strong> Alineación con el campo magnético de la Tierra durante largos períodos.</li>
                                            </ul>
                                            <p class="text-sm text-gray-600 italic">Nota: La magnetización puede ser temporal o permanente, dependiendo del material y el método utilizado.</p>
                                        </div>
                                        <div class="md:w-1/2 flex justify-center items-center">
                                            
                                            <img style="border-radius: 20px;" src="imagen/Screenshot 2025-06-19 104453.png" alt="alt"/>
                                            
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-content" id="teorias">
                                    <div class="flex flex-col md:flex-row">
                                        <div class="md:w-1/2 mb-4 md:mb-0 md:mr-4">
                                            <h3 class="text-lg font-semibold mb-2">Teorías del Magnetismo</h3>
                                            <div class="mb-3">
                                                <p class="font-medium">Teoría de Weber</p>
                                                <p class="text-sm mb-2">Propuso que las moléculas de materiales magnéticos actúan como pequeños imanes, que se alinean cuando se aplica un campo magnético externo.</p>
                                            </div>
                                            <div class="mb-3">
                                                <p class="font-medium">Teoría de Ewing</p>
                                                <p class="text-sm mb-2">Refinó la teoría de Weber, proponiendo que las moléculas magnéticas forman grupos o dominios que pueden reorientarse bajo la influencia de un campo magnético.</p>
                                            </div>
                                            <div class="mb-3">
                                                <p class="font-medium">Teoría de Ampère</p>
                                                <p class="text-sm mb-2">Sugirió que el magnetismo se debe a corrientes microscópicas que fluyen alrededor de cada átomo del material, generando pequeños campos magnéticos.</p>
                                            </div>
                                            <div>
                                                <p class="font-medium">Teoría Moderna (Electrónica)</p>
                                                <p class="text-sm">Explica el magnetismo como resultado del movimiento y spin de los electrones, que crean momentos magnéticos a nivel atómico.</p>
                                            </div>
                                        </div>
                                        <div class="md:w-1/2 flex justify-center items-center">
                                            
                                            <img width="700px" height="auto" style="border-radius: 20px;" src="imagen/nomagnetico.jpg" alt="alt"/>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>


                    <section class="bg-white rounded-lg shadow-lg p-6">
                        <h2 class="text-xl font-bold mb-4 text-blue-700">
                            <i class="fas fa-vr-cardboard mr-2"></i>Simulación Visual
                        </h2>
                        <div class="simulator-container">
                            <div class="simulator-canvas h-64 mb-4" id="magnetic-simulator">
                                <svg width="100%" height="100%" viewBox="0 0 600 300" id="simulation-svg">

                                <g id="field-lines" class="pulsating-field">

                                </g>


                                <g id="magnets">
                                <g id="magnet1" class="magnet" transform="translate(150, 150)">
                                <rect x="-60" y="-20" width="120" height="40" rx="5" fill="#e53e3e" stroke="#c53030" stroke-width="2" />
                                <rect x="-60" y="-20" width="60" height="40" rx="5" fill="#e53e3e" stroke="#c53030" stroke-width="2" />
                                <text x="-30" y="5" text-anchor="middle" fill="white" font-weight="bold" font-size="20">N</text>
                                <text x="30" y="5" text-anchor="middle" fill="white" font-weight="bold" font-size="20">S</text>
                                </g>

                                <g id="magnet2" class="magnet" transform="translate(400, 150)">
                                <rect x="-60" y="-20" width="120" height="40" rx="5" fill="#3182ce" stroke="#2c5282" stroke-width="2" />
                                <rect x="0" y="-20" width="60" height="40" rx="5" fill="#3182ce" stroke="#2c5282" stroke-width="2" />
                                <text x="-30" y="5" text-anchor="middle" fill="white" font-weight="bold" font-size="20">S</text>
                                <text x="30" y="5" text-anchor="middle" fill="white" font-weight="bold" font-size="20">N</text>
                                </g>
                                </g>
                                </svg>
                            </div>

                            <div class="control-panel p-4 mb-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Fuerza magnética</label>
                                        <input type="range" min="1" max="10" value="5" class="slider" id="force-slider">
                                        <div class="flex justify-between text-xs text-gray-500">
                                            <span>Débil</span>
                                            <span>Fuerte</span>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Orientación del imán 2</label>
                                        <input type="range" min="0" max="360" value="0" class="slider" id="orientation-slider">
                                        <div class="flex justify-between text-xs text-gray-500">
                                            <span>0°</span>
                                            <span>360°</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-4 flex justify-center">
                                    <button id="play-pause-btn" class="flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <i class="fas fa-play mr-2"></i>Animar interacción
                                    </button>
                                </div>
                            </div>

                            <div class="bg-blue-50 p-4 rounded-md">
                                <p class="text-sm text-blue-700">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    <strong>Instrucciones:</strong> Arrastra los imanes para ver cómo interactúan. Ajusta la fuerza y orientación con los controles deslizantes. Pulsa el botón "Animar interacción" para ver una simulación del comportamiento magnético.
                                </p>
                            </div>
                        </div>
                    </section>


                    <section class="bg-white rounded-lg shadow-lg p-6">
                        <h2 class="text-xl font-bold mb-4 text-blue-700">
                            <i class="fas fa-globe-americas mr-2"></i>Geomagnetismo
                        </h2>
                        <div class="flex flex-col md:flex-row">
                            <div class="md:w-1/2 mb-4 md:mb-0 md:pr-4">
                                <div class="globe-container" id="globe-container">

                                </div>
                                <div class="flex justify-center mt-4">
                                    <div class="mr-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Latitud</label>
                                        <input type="range" min="-90" max="90" value="0" class="slider w-32" id="latitude-slider">
                                        <div class="flex justify-between text-xs text-gray-500">
                                            <span>-90°</span>
                                            <span>90°</span>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Longitud</label>
                                        <input type="range" min="-180" max="180" value="0" class="slider w-32" id="longitude-slider">
                                        <div class="flex justify-between text-xs text-gray-500">
                                            <span>-180°</span>
                                            <span>180°</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="md:w-1/2">
                                <h3 class="text-lg font-semibold mb-2">Ángulos Geomagnéticos</h3>
                                <div class="mb-4">
                                    <p class="font-medium">Ángulo de Declinación</p>
                                    <p class="text-sm mb-1">Ángulo entre el norte magnético y el norte geográfico.</p>
                                    <div class="bg-gray-100 p-3 rounded-md">
                                        <div class="flex justify-between">
                                            <span class="font-medium text-blue-700">Valor actual:</span>
                                            <span id="declination-value" class="font-medium">12.5° Oeste</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <p class="font-medium">Ángulo de Inclinación</p>
                                    <p class="text-sm mb-1">Ángulo que forma la aguja magnética con la horizontal.</p>
                                    <div class="bg-gray-100 p-3 rounded-md">
                                        <div class="flex justify-between">
                                            <span class="font-medium text-blue-700">Valor actual:</span>
                                            <span id="inclination-value" class="font-medium">63.8° Abajo</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <p class="font-medium">Intensidad del Campo</p>
                                    <p class="text-sm mb-1">Fuerza del campo magnético terrestre en la ubicación seleccionada.</p>
                                    <div class="bg-gray-100 p-3 rounded-md">
                                        <div class="flex justify-between">
                                            <span class="font-medium text-blue-700">Valor actual:</span>
                                            <span id="intensity-value" class="font-medium">48.7 μT</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <canvas id="geomagnetic-chart" height="150"></canvas>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Sección 4: Calculadora en tiempo real -->
                    <section class="bg-white rounded-lg shadow-lg p-6">
                        <h2 class="text-xl font-bold mb-4 text-blue-700">
                            <i class="fas fa-calculator mr-2"></i>Calculadora Magnética
                        </h2>
                        <form id="magnetic-calculator-form" class="mb-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-1 tooltip">
                                            Fuerza magnética (F)
                                            <span class="tooltip-text">Fuerza del campo magnético en Teslas (T)</span>
                                        </label>
                                        <div class="mt-1 relative rounded-md shadow-sm">
                                            <input type="number" step="0.01" min="0" id="magnetic-force" name="magnetic-force" class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-3 pr-12 sm:text-sm border-gray-300 rounded-md" placeholder="0.00">
                                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                                <span class="text-gray-500 sm:text-sm">T</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-1 tooltip">
                                            Distancia (r)
                                            <span class="tooltip-text">Distancia entre los polos magnéticos en metros (m)</span>
                                        </label>
                                        <div class="mt-1 relative rounded-md shadow-sm">
                                            <input type="number" step="0.01" min="0" id="distance" name="distance" class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-3 pr-12 sm:text-sm border-gray-300 rounded-md" placeholder="0.00">
                                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                                <span class="text-gray-500 sm:text-sm">m</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-1 tooltip">
                                            Ángulo (θ)
                                            <span class="tooltip-text">Ángulo entre la dirección del campo y la referencia en grados (°)</span>
                                        </label>
                                        <div class="mt-1 relative rounded-md shadow-sm">
                                            <input type="number" step="1" min="0" max="360" id="angle" name="angle" class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-3 pr-12 sm:text-sm border-gray-300 rounded-md" placeholder="0">
                                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                                <span class="text-gray-500 sm:text-sm">°</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-gray-50 p-4 rounded-md">
                                    <h3 class="text-lg font-semibold mb-4 text-gray-700">Resultados</h3>

                                    <div class="mb-3">
                                        <p class="text-sm font-medium text-gray-500">Fuerza resultante:</p>
                                        <p id="result-force" class="text-2xl font-bold text-blue-600">0.00 N</p>
                                    </div>

                                    <div class="mb-3">
                                        <p class="text-sm font-medium text-gray-500">Componente horizontal:</p>
                                        <p id="result-horizontal" class="text-lg font-medium text-blue-600">0.00 N</p>
                                    </div>

                                    <div class="mb-3">
                                        <p class="text-sm font-medium text-gray-500">Componente vertical:</p>
                                        <p id="result-vertical" class="text-lg font-medium text-blue-600">0.00 N</p>
                                    </div>

                                    <div>
                                        <p class="text-sm font-medium text-gray-500">Flujo magnético:</p>
                                        <p id="result-flux" class="text-lg font-medium text-blue-600">0.00 Wb</p>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-6 flex justify-center">
                                <button type="button" id="reset-calculator-btn" class="mr-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-400">
                                    <i class="fas fa-undo mr-2"></i>Restablecer
                                </button>
                                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <i class="fas fa-calculator mr-2"></i>Calcular
                                </button>
                            </div>
                        </form>

                        <div class="bg-blue-50 p-4 rounded-md">
                            <h4 class="font-medium text-blue-700 mb-2">Fórmulas utilizadas:</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p><strong>Fuerza entre polos:</strong> F = k·(m₁·m₂)/r²</p>
                                    <p><strong>Flujo magnético:</strong> Φ = B·A·cos(θ)</p>
                                </div>
                                <div>
                                    <p><strong>Componente horizontal:</strong> F·cos(θ)</p>
                                    <p><strong>Componente vertical:</strong> F·sin(θ)</p>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </main>

            <button id="reset-all-btn" class="reset-button bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-full shadow-lg">
                <i class="fas fa-redo-alt mr-2"></i>Reiniciar todo
            </button>

            <footer class="bg-gray-800 text-white mt-8 py-6">
                <div class="container mx-auto px-4">
                    <div class="flex flex-col md:flex-row justify-between items-center">
                        <div class="mb-4 md:mb-0">
                            <h3 class="text-xl font-bold mb-2">eFunctions Fisica IV</h3>
                            <p class="text-gray-300 text-sm">Aplicación educativa sobre principios de magnetismo</p>
                        </div>
                        <div>
                            <p class="text-gray-300 text-sm">&copy; 2025 eFunctions Fisica IV</p>
                            <p class="text-gray-300 text-sm">&copy; Cortés Manuel Christopher 
                        Jerónimo Cárdenas Eduardo 
                        Lobo Vázquez Mario Alberto 
                        Martínez Pastrana Alfredo Yahir</p>
                        </div>
                    </div>
                </div>
            </footer>
        </div>

        <script id="app-script">

            document.addEventListener('DOMContentLoaded', function () {

                const tabButtons = document.querySelectorAll('.tab-button');

                tabButtons.forEach(button => {
                    button.addEventListener('click', function () {

                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));


                        this.classList.add('active');
                        const tabId = this.getAttribute('data-tab');
                        document.getElementById(tabId).classList.add('active');


                        localStorage.setItem('activeTab', tabId);
                    });
                });


                const activeTab = localStorage.getItem('activeTab');
                if (activeTab) {
                    const tabToActivate = document.querySelector(`.tab-button[data-tab="${activeTab}"]`);
                    if (tabToActivate) {
                        tabToActivate.click();
                    }
                }


                initMagneticSimulation();


                initGlobe();


                initCalculator();


                document.getElementById('reset-all-btn').addEventListener('click', function () {
                    if (confirm('¿Estás seguro de que deseas reiniciar toda la aplicación? Se perderán todos los datos guardados.')) {
                        localStorage.clear();
                        location.reload();
                    }
                });
            });


            function initMagneticSimulation() {
                const svg = document.getElementById('simulation-svg');
                const magnet1 = document.getElementById('magnet1');
                const magnet2 = document.getElementById('magnet2');
                const fieldLines = document.getElementById('field-lines');
                const forceSlider = document.getElementById('force-slider');
                const orientationSlider = document.getElementById('orientation-slider');
                const playPauseBtn = document.getElementById('play-pause-btn');

                let isDragging = false;
                let currentMagnet = null;
                let offset = {x: 0, y: 0};
                let isAnimating = false;


                const savedConfig = JSON.parse(localStorage.getItem('magneticSimConfig') || '{}');
                if (savedConfig.magnet1Position) {
                    magnet1.setAttribute('transform', `translate(${savedConfig.magnet1Position.x}, ${savedConfig.magnet1Position.y})`);
                }
                if (savedConfig.magnet2Position) {
                    magnet2.setAttribute('transform', `translate(${savedConfig.magnet2Position.x}, ${savedConfig.magnet2Position.y})`);
                }
                if (savedConfig.force) {
                    forceSlider.value = savedConfig.force;
                }
                if (savedConfig.orientation) {
                    orientationSlider.value = savedConfig.orientation;
                    updateMagnet2Orientation(savedConfig.orientation);
                }


                generateFieldLines();


                [magnet1, magnet2].forEach(magnet => {
                    magnet.addEventListener('mousedown', startDrag);
                    magnet.addEventListener('touchstart', startDrag, {passive: false});
                });

                document.addEventListener('mousemove', drag);
                document.addEventListener('touchmove', drag, {passive: false});

                document.addEventListener('mouseup', endDrag);
                document.addEventListener('touchend', endDrag);


                forceSlider.addEventListener('input', function () {
                    const force = parseInt(this.value);

                    saveSimulationConfig();
                    generateFieldLines();
                });


                orientationSlider.addEventListener('input', function () {
                    const angle = parseInt(this.value);
                    updateMagnet2Orientation(angle);
                    saveSimulationConfig();
                    generateFieldLines();
                });


                playPauseBtn.addEventListener('click', function () {
                    if (isAnimating) {
                        stopAnimation();
                        this.innerHTML = '<i class="fas fa-play mr-2"></i>Animar interacción';
                    } else {
                        startAnimation();
                        this.innerHTML = '<i class="fas fa-pause mr-2"></i>Detener animación';
                    }
                });

                function startDrag(event) {
                    event.preventDefault();

                    isDragging = true;
                    currentMagnet = this;


                    const transform = currentMagnet.getAttribute('transform');
                    const match = transform.match(/translate\(([^,]+),\s*([^)]+)\)/);
                    const currentX = parseFloat(match[1]);
                    const currentY = parseFloat(match[2]);


                    if (event.type === 'mousedown') {
                        const pt = svg.createSVGPoint();
                        pt.x = event.clientX;
                        pt.y = event.clientY;
                        const svgP = pt.matrixTransform(svg.getScreenCTM().inverse());
                        offset.x = svgP.x - currentX;
                        offset.y = svgP.y - currentY;
                    } else {
                        const pt = svg.createSVGPoint();
                        pt.x = event.touches[0].clientX;
                        pt.y = event.touches[0].clientY;
                        const svgP = pt.matrixTransform(svg.getScreenCTM().inverse());
                        offset.x = svgP.x - currentX;
                        offset.y = svgP.y - currentY;
                    }
                }

                function drag(event) {
                    if (!isDragging)
                        return;
                    event.preventDefault();

                    let x, y;
                    if (event.type === 'mousemove') {
                        const pt = svg.createSVGPoint();
                        pt.x = event.clientX;
                        pt.y = event.clientY;
                        const svgP = pt.matrixTransform(svg.getScreenCTM().inverse());
                        x = svgP.x - offset.x;
                        y = svgP.y - offset.y;
                    } else {
                        const pt = svg.createSVGPoint();
                        pt.x = event.touches[0].clientX;
                        pt.y = event.touches[0].clientY;
                        const svgP = pt.matrixTransform(svg.getScreenCTM().inverse());
                        x = svgP.x - offset.x;
                        y = svgP.y - offset.y;
                    }


                    x = Math.max(60, Math.min(x, 540));
                    y = Math.max(30, Math.min(y, 270));

                    currentMagnet.setAttribute('transform', `translate(${x}, ${y})`);
                    generateFieldLines();
                }

                function endDrag() {
                    if (isDragging) {
                        isDragging = false;
                        saveSimulationConfig();
                    }
                }

                function updateMagnet2Orientation(angle) {

                    const transform = magnet2.getAttribute('transform');
                    const match = transform.match(/translate\(([^,]+),\s*([^)]+)\)/);
                    const x = parseFloat(match[1]);
                    const y = parseFloat(match[2]);


                    magnet2.setAttribute('transform', `translate(${x}, ${y}) rotate(${angle})`);
                }

                function generateFieldLines() {

                    while (fieldLines.firstChild) {
                        fieldLines.removeChild(fieldLines.firstChild);
                    }


                    const m1Transform = magnet1.getAttribute('transform');
                    const m1Match = m1Transform.match(/translate\(([^,]+),\s*([^)]+)\)/);
                    const m1x = parseFloat(m1Match[1]);
                    const m1y = parseFloat(m1Match[2]);

                    const m2Transform = magnet2.getAttribute('transform');
                    const m2Match = m2Transform.match(/translate\(([^,]+),\s*([^)]+)\)/);
                    const m2x = parseFloat(m2Match[1]);
                    const m2y = parseFloat(m2Match[2]);


                    const dx = m2x - m1x;
                    const dy = m2y - m1y;
                    const distance = Math.sqrt(dx * dx + dy * dy);


                    const force = parseInt(forceSlider.value);
                    const lineCount = 8 + Math.floor(force / 2);

                    for (let i = 0; i < lineCount; i++) {
                        const offset = (i - lineCount / 2) * 10;


                        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');


                        const cpx = (m1x + m2x) / 2;
                        const cpy = (m1y + m2y) / 2 + offset;

                        path.setAttribute('d', `M${m1x},${m1y + offset} Q${cpx},${cpy} ${m2x},${m2y + offset}`);
                        path.setAttribute('class', 'field-line');
                        path.style.strokeOpacity = 0.3 + (force / 20); // Ajustar opacidad según fuerza

                        fieldLines.appendChild(path);
                    }
                }

                function saveSimulationConfig() {

                    const m1Transform = magnet1.getAttribute('transform');
                    const m1Match = m1Transform.match(/translate\(([^,]+),\s*([^)]+)\)/);
                    const m1x = parseFloat(m1Match[1]);
                    const m1y = parseFloat(m1Match[2]);

                    const m2Transform = magnet2.getAttribute('transform');
                    const m2Match = m2Transform.match(/translate\(([^,]+),\s*([^)]+)\)/);
                    const m2x = parseFloat(m2Match[1]);
                    const m2y = parseFloat(m2Match[2]);

                    const config = {
                        magnet1Position: {x: m1x, y: m1y},
                        magnet2Position: {x: m2x, y: m2y},
                        force: forceSlider.value,
                        orientation: orientationSlider.value
                    };

                    localStorage.setItem('magneticSimConfig', JSON.stringify(config));
                }


                function startAnimation() {
                    isAnimating = true;


                    const animation = setInterval(() => {

                        const m1Transform = magnet1.getAttribute('transform');
                        const m1Match = m1Transform.match(/translate\(([^,]+),\s*([^)]+)\)/);
                        const m1x = parseFloat(m1Match[1]);
                        const m1y = parseFloat(m1Match[2]);

                        const m2Transform = magnet2.getAttribute('transform');
                        const m2Match = m2Transform.match(/translate\(([^,]+),\s*([^)]+)\)/);
                        let m2x = parseFloat(m2Match[1]);
                        let m2y = parseFloat(m2Match[2]);


                        const dx = m1x - m2x;
                        const dy = m1y - m2y;
                        const distance = Math.sqrt(dx * dx + dy * dy);


                        if (distance < 80 || distance > 400) {
                            stopAnimation();
                            return;
                        }


                        const force = parseFloat(forceSlider.value);
                        const angle = parseFloat(orientationSlider.value) % 360;


                        let effect = 0;
                        if ((angle >= 315 && angle <= 360) || (angle >= 0 && angle <= 45)) {

                            effect = -1;
                        } else if (angle >= 135 && angle <= 225) {

                            effect = 1;
                        } else {

                            effect = 0.3 * ((angle > 45 && angle < 135) ? -1 : 1);
                        }


                        const velocityFactor = 0.005 * force;


                        if (distance > 0) {
                            const dirX = dx / distance;
                            const dirY = dy / distance;
                            m2x += dirX * velocityFactor * effect * distance * 0.1;
                            m2y += dirY * velocityFactor * effect * distance * 0.1;
                        }

                        magnet2.setAttribute('transform', `translate(${m2x}, ${m2y}) rotate(${angle})`);
                        generateFieldLines();
                    }, 30);

                    window.magneticAnimation = animation;
                }

                function stopAnimation() {
                    isAnimating = false;
                    if (window.magneticAnimation) {
                        clearInterval(window.magneticAnimation);
                    }
                }
            }


            function initGlobe() {

                const container = document.getElementById('globe-container');
                const width = container.clientWidth;
                const height = container.clientHeight;


                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
                camera.position.z = 3;

                const renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});
                renderer.setSize(width, height);
                renderer.setClearColor(0xffffff, 0);
                container.appendChild(renderer.domElement);


                const geometry = new THREE.SphereGeometry(1, 32, 32);


                const earthTexture = new THREE.TextureLoader().load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/land_ocean_ice_cloud_2048.jpg');
                const material = new THREE.MeshBasicMaterial({map: earthTexture});

                const globe = new THREE.Mesh(geometry, material);
                scene.add(globe);


                const arrowGeometry = new THREE.ConeGeometry(0.1, 0.3, 32);
                const arrowMaterial = new THREE.MeshBasicMaterial({color: 0xe53e3e});
                const arrow = new THREE.Mesh(arrowGeometry, arrowMaterial);
                arrow.position.set(0, 0, 1.2);
                arrow.rotation.x = Math.PI / 4;
                scene.add(arrow);


                const lineMaterial = new THREE.LineBasicMaterial({color: 0x3182ce});
                const linePoints = [];
                linePoints.push(new THREE.Vector3(0, 0, 0));
                linePoints.push(new THREE.Vector3(0, 0, 1.5));

                const lineGeometry = new THREE.BufferGeometry().setFromPoints(linePoints);
                const line = new THREE.Line(lineGeometry, lineMaterial);
                scene.add(line);


                const latitudeSlider = document.getElementById('latitude-slider');
                const longitudeSlider = document.getElementById('longitude-slider');


                const savedPosition = JSON.parse(localStorage.getItem('geomagneticPosition') || '{}');
                if (savedPosition.latitude) {
                    latitudeSlider.value = savedPosition.latitude;
                }
                if (savedPosition.longitude) {
                    longitudeSlider.value = savedPosition.longitude;
                }

                latitudeSlider.addEventListener('input', updateGlobePosition);
                longitudeSlider.addEventListener('input', updateGlobePosition);

                function updateGlobePosition() {
                    const latitude = parseFloat(latitudeSlider.value);
                    const longitude = parseFloat(longitudeSlider.value);


                    const phi = (90 - latitude) * (Math.PI / 180);
                    const theta = (longitude + 180) * (Math.PI / 180);


                    globe.rotation.y = -theta;
                    globe.rotation.x = phi - Math.PI / 2;


                    updateMagneticAngles(latitude, longitude);


                    localStorage.setItem('geomagneticPosition', JSON.stringify({
                        latitude: latitude,
                        longitude: longitude
                    }));
                }

                function updateMagneticAngles(latitude, longitude) {

                    const declinationBase = 12.5 + (longitude / 30);
                    const inclinationBase = 65 - (Math.abs(latitude) / 2);
                    const intensityBase = 30 + (Math.abs(latitude) / 90) * 40;


                    const declination = declinationBase + Math.sin(latitude * 0.1) * 5;
                    const inclination = inclinationBase + Math.cos(longitude * 0.1) * 10;
                    const intensity = intensityBase + Math.sin(latitude * longitude * 0.001) * 8;


                    document.getElementById('declination-value').textContent = `${declination.toFixed(1)}° ${declination > 0 ? 'Este' : 'Oeste'}`;
                    document.getElementById('inclination-value').textContent = `${inclination.toFixed(1)}° ${inclination > 0 ? 'Abajo' : 'Arriba'}`;
                    document.getElementById('intensity-value').textContent = `${intensity.toFixed(1)} μT`;


                    arrow.rotation.x = (inclination * Math.PI) / 180;
                    arrow.rotation.y = (declination * Math.PI) / 180;

                }


                function animate() {
                    requestAnimationFrame(animate);


                    globe.rotation.y += 0.002;

                    renderer.render(scene, camera);
                }


                updateGlobePosition();
                animate();


                window.addEventListener('resize', function () {
                    const newWidth = container.clientWidth;
                    const newHeight = container.clientHeight;
                    camera.aspect = newWidth / newHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(newWidth, newHeight);
                });
            }


            function initCalculator() {
                const form = document.getElementById('magnetic-calculator-form');
                const resetBtn = document.getElementById('reset-calculator-btn');


                const savedValues = JSON.parse(localStorage.getItem('magneticCalculatorValues') || '{}');
                if (savedValues.force) {
                    document.getElementById('magnetic-force').value = savedValues.force;
                }
                if (savedValues.distance) {
                    document.getElementById('distance').value = savedValues.distance;
                }
                if (savedValues.angle) {
                    document.getElementById('angle').value = savedValues.angle;
                }


                form.addEventListener('submit', function (e) {
                    e.preventDefault();
                    calculateResults();
                });


                ['magnetic-force', 'distance', 'angle'].forEach(id => {
                    document.getElementById(id).addEventListener('input', function () {
                        saveCalculatorValues();
                        calculateResults();
                    });
                });


                resetBtn.addEventListener('click', function () {
                    form.reset();
                    document.getElementById('result-force').textContent = '0.00 N';
                    document.getElementById('result-horizontal').textContent = '0.00 N';
                    document.getElementById('result-vertical').textContent = '0.00 N';
                    document.getElementById('result-flux').textContent = '0.00 Wb';


                    localStorage.removeItem('magneticCalculatorValues');
                });

                function calculateResults() {
                    const force = parseFloat(document.getElementById('magnetic-force').value) || 0;
                    const distance = parseFloat(document.getElementById('distance').value) || 0;
                    const angle = parseFloat(document.getElementById('angle').value) || 0;

                    if (force === 0 || distance === 0) {
                        return;
                    }


                    const angleRad = angle * (Math.PI / 180);


                    const resultForce = force / (distance * distance);


                    const horizontal = resultForce * Math.cos(angleRad);
                    const vertical = resultForce * Math.sin(angleRad);


                    const flux = force * Math.cos(angleRad);


                    document.getElementById('result-force').textContent = `${resultForce.toFixed(2)} N`;
                    document.getElementById('result-horizontal').textContent = `${horizontal.toFixed(2)} N`;
                    document.getElementById('result-vertical').textContent = `${vertical.toFixed(2)} N`;
                    document.getElementById('result-flux').textContent = `${flux.toFixed(2)} Wb`;
                }

                function saveCalculatorValues() {
                    const values = {
                        force: document.getElementById('magnetic-force').value,
                        distance: document.getElementById('distance').value,
                        angle: document.getElementById('angle').value
                    };

                    localStorage.setItem('magneticCalculatorValues', JSON.stringify(values));
                }

                if (savedValues.force || savedValues.distance || savedValues.angle) {
                    calculateResults();
                }
            }
        </script>
    </body>
</html>
